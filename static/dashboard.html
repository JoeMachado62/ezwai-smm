<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EZWAI SMM - AI Content Dashboard</title>
    <link rel="icon" type="image/webp" href="/static/ezwai icon portal copy.webp">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #046675 0%, #023d47 100%);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
            position: relative;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-logo {
            max-height: 80px;
            width: auto;
        }

        .header-text {
            flex: 1;
        }

        .header h1 {
            font-size: 2.5em;
            color: #1a1a1a;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
            }

            .header-logo {
                max-height: 60px;
            }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 968px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            font-size: 1.8em;
            color: #1a1a1a;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1em;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #08b0c4;
            box-shadow: 0 0 0 3px rgba(8, 176, 196, 0.1);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #ff6b11 0%, #e55a00 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 107, 17, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: white;
            color: #08b0c4;
            border: 2px solid #08b0c4;
        }

        .btn-secondary:hover {
            background: #08b0c4;
            color: white;
        }

        .style-template-btn {
            background: linear-gradient(135deg, #08b0c4 0%, #06899a 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            margin-left: 15px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .style-template-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(8, 176, 196, 0.3);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #ffffff;
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            background: linear-gradient(135deg, #08b0c4 0%, #06899a 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 20px 20px 0 0;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 24px;
        }

        .modal-body {
            padding: 30px;
        }

        .template-item {
            padding: 18px;
            margin-bottom: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-item:hover {
            border-color: #08b0c4;
            background-color: #f0f9fb;
            transform: translateX(5px);
        }

        .template-name {
            font-weight: 700;
            font-size: 16px;
            color: #08b0c4;
            margin-bottom: 8px;
        }

        .template-preview {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }

        .close-modal {
            color: white;
            float: right;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close-modal:hover {
            opacity: 0.8;
        }

        .progress-section {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9ff;
            border-radius: 15px;
            display: none;
        }

        .progress-section.active {
            display: block;
        }

        .progress-bar-container {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #08b0c4 0%, #06899a 100%);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .progress-text {
            color: #666;
            font-size: 0.95em;
            text-align: center;
        }

        .status-message {
            padding: 15px 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-weight: 500;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #08b0c4;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        @media (max-width: 1200px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stat-card {
            background: linear-gradient(135deg, #08b0c4 0%, #06899a 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card.credits {
            background: linear-gradient(135deg, #ff6b11 0%, #e55a00 100%);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .stat-card.credits:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 107, 17, 0.3);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .credit-action {
            font-size: 0.75em;
            opacity: 0.9;
            margin-top: 8px;
            font-weight: 600;
        }

        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: white;
            padding: 10px;
            border-radius: 15px;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1em;
            color: #666;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #ff6b11 0%, #e55a00 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .schedule-grid {
            display: grid;
            gap: 15px;
        }

        .schedule-item {
            display: grid;
            grid-template-columns: 150px 1fr 1fr auto;
            gap: 15px;
            align-items: center;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 10px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #08b0c4;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .query-list {
            display: grid;
            gap: 12px;
        }

        .query-item {
            display: flex;
            gap: 10px;
        }

        .query-item input {
            flex: 1;
        }

        .btn-small {
            padding: 10px 20px;
            font-size: 0.9em;
            width: auto;
        }

        .preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }

        .preview-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .preview-content {
            background: white;
            border-radius: 20px;
            max-width: 1200px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .preview-header {
            position: sticky;
            top: 0;
            background: white;
            padding: 25px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 20px 20px 0 0;
        }

        .close-preview {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .preview-body {
            padding: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="/static/EZWai logo  and Tagline.png" alt="EZWAI Logo" class="header-logo">
            <div class="header-text">
                <h1>EZWAI SMM Dashboard</h1>
                <p>AI-Powered Content Management for WordPress</p>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card credits" onclick="switchTab('billing')" title="Click to manage credits">
                <div class="stat-number">$<span id="creditBalance">0.00</span></div>
                <div class="stat-label">Credit Balance</div>
                <div class="credit-action">💳 Click to Buy Credits</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalPosts">0</div>
                <div class="stat-label">Total Posts</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="scheduledPosts">0</div>
                <div class="stat-label">Scheduled</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="activeQueries">0</div>
                <div class="stat-label">Active Topics</div>
            </div>
        </div>

        <div class="tab-navigation">
            <button class="tab-btn active" onclick="switchTab('create')">✨ Create Post</button>
            <button class="tab-btn" onclick="switchTab('queries')">📝 Topics</button>
            <button class="tab-btn" onclick="switchTab('schedule')">📅 Schedule</button>
            <button class="tab-btn" onclick="switchTab('billing')">💳 Credits & Billing</button>
            <button class="tab-btn" onclick="switchTab('settings')">⚙️ Settings</button>
        </div>

        <!-- Create Post Tab -->
        <div id="createTab" class="tab-content active">
            <div class="card">
                <h2><span class="card-icon">✍️</span> Create Magazine-Style Article</h2>

                <form id="createPostForm">
                    <div class="form-group">
                        <label for="postTopic">Article Topic or News Query</label>
                        <textarea
                            id="postTopic"
                            placeholder="E.g., 'Latest trends in artificial intelligence for small businesses'"
                            required
                        ></textarea>
                    </div>

                    <div class="form-group">
                        <label for="systemPrompt">
                            Writing Style & Instructions
                            <button type="button" class="style-template-btn" onclick="showStyleTemplates()">
                                📋 Style Templates
                            </button>
                        </label>
                        <textarea
                            id="systemPrompt"
                            placeholder="E.g., 'Write in a professional but conversational tone, targeting small business owners. Include practical examples and actionable tips.'"
                        ></textarea>
                    </div>

                    <button type="submit" class="btn" id="createBtn">
                        🚀 Generate Magazine Article (1500+ words)
                    </button>
                </form>

                <div class="progress-section" id="progressSection">
                    <div class="progress-text" id="progressText">Initializing...</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                </div>

                <div id="statusMessage"></div>
            </div>
        </div>

        <!-- Topics Tab -->
        <div id="queriesTab" class="tab-content">
            <div class="card">
                <h2><span class="card-icon">📝</span> Content Topics</h2>
                <p style="margin-bottom: 25px; color: #666;">
                    Add up to 10 topics. The system will rotate through them for scheduled posts.
                </p>

                <div class="query-list" id="queryList">
                    <!-- Queries will be populated here -->
                </div>

                <button class="btn" onclick="saveQueries()" style="margin-top: 20px;">
                    💾 Save Topics
                </button>
            </div>
        </div>

        <!-- Schedule Tab -->
        <div id="scheduleTab" class="tab-content">
            <div class="card">
                <h2><span class="card-icon">📅</span> Publishing Schedule</h2>
                <p style="margin-bottom: 25px; color: #666;">
                    Configure when to automatically publish articles (up to 2 times per day)
                </p>

                <div class="schedule-grid" id="scheduleGrid">
                    <!-- Schedule items will be populated here -->
                </div>

                <button class="btn" onclick="saveSchedule()" style="margin-top: 20px;">
                    💾 Save Schedule
                </button>
            </div>
        </div>

        <!-- Billing Tab -->
        <div id="billingTab" class="tab-content">
            <div class="dashboard-grid">
                <div class="card">
                    <h2><span class="card-icon">💰</span> Buy Credits</h2>
                    <p style="color: #666; margin-bottom: 25px;">
                        Credits are used to generate blog posts. Each article costs approximately $0.45.
                    </p>

                    <div class="form-group">
                        <label>Select Credit Package</label>
                        <select id="creditPackage" style="font-size: 1.1em; padding: 16px;">
                            <option value="10">$10.00 - Starter (~22 articles)</option>
                            <option value="25" selected>$25.00 - Basic (~55 articles)</option>
                            <option value="50">$50.00 - Pro (~111 articles)</option>
                            <option value="100">$100.00 - Premium (~222 articles)</option>
                            <option value="250">$250.00 - Enterprise (~555 articles)</option>
                        </select>
                    </div>

                    <button class="btn" onclick="purchaseCredits()">
                        🛒 Purchase Credits
                    </button>

                    <div style="margin-top: 30px; padding: 20px; background: #f8f9ff; border-radius: 12px;">
                        <h3 style="font-size: 1.2em; margin-bottom: 15px;">💳 Current Balance</h3>
                        <p style="font-size: 2em; font-weight: 700; color: #ff6b11; margin: 10px 0;">
                            $<span id="currentBalance">0.00</span>
                        </p>
                        <p style="color: #666; font-size: 0.9em;">
                            Estimated articles remaining: <strong id="estimatedArticles">0</strong>
                        </p>
                    </div>
                </div>

                <div class="card">
                    <h2><span class="card-icon">🔄</span> Auto-Recharge Settings</h2>
                    <p style="color: #666; margin-bottom: 25px;">
                        Automatically purchase credits when your balance runs low.
                    </p>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 12px;">
                            <input type="checkbox" id="autoRechargeEnabled" style="width: 24px; height: 24px; cursor: pointer;">
                            <span style="font-weight: 600;">Enable Auto-Recharge</span>
                        </label>
                    </div>

                    <div id="autoRechargeSettings" style="display: none; margin-top: 20px;">
                        <div class="form-group">
                            <label>Recharge When Balance Falls Below</label>
                            <select id="autoRechargeThreshold" style="font-size: 1.05em;">
                                <option value="5">$5.00</option>
                                <option value="10" selected>$10.00</option>
                                <option value="25">$25.00</option>
                                <option value="50">$50.00</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Recharge Amount</label>
                            <select id="autoRechargeAmount" style="font-size: 1.05em;">
                                <option value="25" selected>$25.00</option>
                                <option value="50">$50.00</option>
                                <option value="100">$100.00</option>
                                <option value="250">$250.00</option>
                            </select>
                        </div>

                        <div style="padding: 15px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 8px; margin-bottom: 20px;">
                            <p style="color: #856404; font-size: 0.9em; margin: 0;">
                                ⚠️ You'll be charged automatically when your balance drops below the threshold.
                            </p>
                        </div>
                    </div>

                    <button class="btn" onclick="saveAutoRecharge()">
                        💾 Save Auto-Recharge Settings
                    </button>
                </div>
            </div>

            <div class="card" style="margin-top: 30px;">
                <h2><span class="card-icon">📊</span> Transaction History</h2>
                <div id="transactionHistory" style="max-height: 400px; overflow-y: auto;">
                    <p style="color: #999; text-align: center; padding: 40px;">
                        Loading transactions...
                    </p>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settingsTab" class="tab-content">
            <div class="dashboard-grid">
                <div class="card">
                    <h2><span class="card-icon">🌐</span> WordPress Settings</h2>
                    <div class="form-group">
                        <label for="wpUrl">REST API URL</label>
                        <input
                            type="url"
                            id="wpUrl"
                            placeholder="https://yoursite.com/wp-json/wp/v2"
                        />
                    </div>
                    <div class="form-group">
                        <label for="wpUsername">Username</label>
                        <input
                            type="text"
                            id="wpUsername"
                        />
                    </div>
                    <div class="form-group">
                        <label for="wpPassword">Application Password</label>
                        <input
                            type="password"
                            id="wpPassword"
                        />
                    </div>
                    <button class="btn" onclick="saveWordPress()">Save</button>
                </div>

                <div class="card">
                    <h2><span class="card-icon">🎨</span> Brand Customization</h2>
                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 16px;">
                        Customize your article colors or use EZWAi defaults (Teal & Orange)
                    </p>

                    <div class="form-group">
                        <label for="brandPrimary">Primary Brand Color (Headers/Borders)</label>
                        <div style="display: flex; gap: 12px; align-items: stretch;">
                            <div style="position: relative;">
                                <input
                                    type="color"
                                    id="brandPrimaryPicker"
                                    value="#08b2c6"
                                    title="Click to open color picker"
                                    style="
                                        width: 80px;
                                        height: 48px;
                                        border: 2px solid #ddd;
                                        border-radius: 8px;
                                        cursor: pointer;
                                        padding: 2px;
                                    "
                                />
                                <div style="
                                    position: absolute;
                                    bottom: -20px;
                                    left: 0;
                                    right: 0;
                                    text-align: center;
                                    font-size: 0.75rem;
                                    color: #666;
                                ">Pick Color</div>
                            </div>
                            <input
                                type="text"
                                id="brandPrimary"
                                value="#08b2c6"
                                pattern="^#[0-9A-Fa-f]{6}$"
                                placeholder="#08b2c6"
                                title="Or type hex color code"
                                style="flex: 1; font-family: monospace; font-size: 1rem;"
                            />
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 32px;">
                        <label for="brandAccent">Accent Color (Buttons/Highlights)</label>
                        <div style="display: flex; gap: 12px; align-items: stretch;">
                            <div style="position: relative;">
                                <input
                                    type="color"
                                    id="brandAccentPicker"
                                    value="#ff6b11"
                                    title="Click to open color picker"
                                    style="
                                        width: 80px;
                                        height: 48px;
                                        border: 2px solid #ddd;
                                        border-radius: 8px;
                                        cursor: pointer;
                                        padding: 2px;
                                    "
                                />
                                <div style="
                                    position: absolute;
                                    bottom: -20px;
                                    left: 0;
                                    right: 0;
                                    text-align: center;
                                    font-size: 0.75rem;
                                    color: #666;
                                ">Pick Color</div>
                            </div>
                            <input
                                type="text"
                                id="brandAccent"
                                value="#ff6b11"
                                pattern="^#[0-9A-Fa-f]{6}$"
                                placeholder="#ff6b11"
                                title="Or type hex color code"
                                style="flex: 1; font-family: monospace; font-size: 1rem;"
                            />
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 32px; padding-top: 20px; border-top: 1px solid #eee;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="useDefaultBranding" style="width: 18px; height: 18px; cursor: pointer;">
                            <span>Reset to EZWAi Default Colors</span>
                        </label>
                        <p style="color: #999; font-size: 0.85rem; margin-top: 8px; margin-left: 26px;">
                            Check this to use the default teal (#08b2c6) and orange (#ff6b11) branding
                        </p>
                    </div>

                    <button class="btn" onclick="saveBrandColors()" style="margin-top: 24px; width: 100%;">Save Brand Colors</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="preview-modal" id="previewModal">
        <div class="preview-content">
            <div class="preview-header">
                <h2>Article Preview</h2>
                <button class="close-preview" onclick="closePreview()">Close</button>
            </div>
            <div class="preview-body" id="previewBody">
                <!-- Article preview will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');

            // Load data for specific tabs
            if (tabName === 'queries') loadQueries();
            if (tabName === 'schedule') loadSchedule();
            if (tabName === 'billing') loadBilling();
            if (tabName === 'settings') loadSettings();
        }

        // Create Post
        document.getElementById('createPostForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const topic = document.getElementById('postTopic').value;
            const systemPrompt = document.getElementById('systemPrompt').value ||
                'Write a comprehensive, engaging article in a professional but conversational tone.';

            const btn = document.getElementById('createBtn');
            const progressSection = document.getElementById('progressSection');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const statusMessage = document.getElementById('statusMessage');

            btn.disabled = true;
            progressSection.classList.add('active');
            statusMessage.innerHTML = '';

            // Simulate progress
            let progress = 0;
            const progressStages = [
                'Analyzing topic...',
                'Generating article structure...',
                'Writing magazine-style content...',
                'Creating hero image...',
                'Generating section images...',
                'Finalizing article...',
                'Publishing to WordPress...'
            ];

            const progressInterval = setInterval(() => {
                if (progress < 90) {
                    progress += Math.random() * 15;
                    if (progress > 90) progress = 90;
                    progressBar.style.width = progress + '%';
                    const stage = Math.floor(progress / (90 / progressStages.length));
                    progressText.textContent = progressStages[stage] || 'Processing...';
                }
            }, 1000);

            try {
                const response = await fetch('/api/create_test_post', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        blog_post_idea: topic,
                        system_prompt: systemPrompt,
                        writing_style: systemPrompt  // Use systemPrompt as writing style for Perplexity
                    })
                });

                clearInterval(progressInterval);
                progress = 100;
                progressBar.style.width = '100%';
                progressText.textContent = 'Complete!';

                const data = await response.json();

                if (response.ok) {
                    statusMessage.innerHTML = `
                        <div class="status-message status-success">
                            <strong>✅ Success!</strong> Article "${data.title}" has been created and published to WordPress as a draft.
                            ${data.warning ? '<br><br>⚠️ ' + data.warning : ''}
                        </div>
                    `;

                    // Show preview option
                    if (data.content) {
                        statusMessage.innerHTML += `
                            <button class="btn btn-secondary" onclick="showPreview(${JSON.stringify(data.content).replace(/"/g, '&quot;')})" style="margin-top: 15px;">
                                👁️ Preview Article
                            </button>
                        `;
                    }
                } else {
                    throw new Error(data.error || 'Failed to create post');
                }
            } catch (error) {
                clearInterval(progressInterval);
                statusMessage.innerHTML = `
                    <div class="status-message status-error">
                        <strong>❌ Error:</strong> ${error.message}
                    </div>
                `;
            } finally {
                btn.disabled = false;
                setTimeout(() => {
                    progressSection.classList.remove('active');
                }, 3000);
            }
        });

        // Load and save queries
        function loadQueries() {
            fetch('/api/get_specific_queries', {
                credentials: 'include'
            })
            .then(res => res.json())
            .then(data => {
                const queryList = document.getElementById('queryList');
                queryList.innerHTML = '';

                for (let i = 1; i <= 10; i++) {
                    const queryValue = data.queries ? (data.queries[i] || '') : (data[i] || '');
                    const styleValue = data.styles ? (data.styles[i] || '') : '';
                    queryList.innerHTML += `
                        <div class="query-item">
                            <input
                                type="text"
                                id="query${i}"
                                placeholder="Topic ${i}"
                                value="${queryValue}"
                                style="flex: 2; margin-right: 10px;"
                            />
                            <select id="style${i}" style="flex: 1;">
                                <option value="">Select Writing Style</option>
                                <option value="Conversational/Personal" ${styleValue === 'Conversational/Personal' ? 'selected' : ''}>Conversational/Personal</option>
                                <option value="Authoritative/Expert" ${styleValue === 'Authoritative/Expert' ? 'selected' : ''}>Authoritative/Expert</option>
                                <option value="Narrative/Storytelling" ${styleValue === 'Narrative/Storytelling' ? 'selected' : ''}>Narrative/Storytelling</option>
                                <option value="Listicle/Scannable" ${styleValue === 'Listicle/Scannable' ? 'selected' : ''}>Listicle/Scannable</option>
                                <option value="Investigative/Journalistic" ${styleValue === 'Investigative/Journalistic' ? 'selected' : ''}>Investigative/Journalistic</option>
                                <option value="How-to/Instructional" ${styleValue === 'How-to/Instructional' ? 'selected' : ''}>How-to/Instructional</option>
                                <option value="Opinion/Commentary" ${styleValue === 'Opinion/Commentary' ? 'selected' : ''}>Opinion/Commentary</option>
                                <option value="Humorous/Satirical" ${styleValue === 'Humorous/Satirical' ? 'selected' : ''}>Humorous/Satirical</option>
                            </select>
                        </div>
                    `;
                }

                updateStats();
            })
            .catch(err => console.error('Error loading queries:', err));
        }

        function saveQueries() {
            const queries = {};
            const styles = {};
            for (let i = 1; i <= 10; i++) {
                const queryValue = document.getElementById(`query${i}`).value;
                const styleValue = document.getElementById(`style${i}`).value;
                if (queryValue) queries[i] = queryValue;
                if (styleValue) styles[i] = styleValue;
            }

            fetch('/api/save_specific_queries', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({
                    specific_topic_queries: queries,
                    writing_styles: styles
                })
            })
            .then(res => res.json())
            .then(data => {
                alert('✅ Topics saved successfully!');
                updateStats();
            })
            .catch(err => alert('❌ Error saving topics: ' + err.message));
        }

        // Load and save schedule
        function loadSchedule() {
            fetch('/api/profile', {
                credentials: 'include'
            })
            .then(res => res.json())
            .then(data => {
                const schedule = data.schedule || [];
                const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                const scheduleGrid = document.getElementById('scheduleGrid');
                scheduleGrid.innerHTML = '';

                days.forEach((day, index) => {
                    const daySchedule = schedule[index] || { enabled: false, time1: '', time2: '' };
                    scheduleGrid.innerHTML += `
                        <div class="schedule-item">
                            <strong>${day}</strong>
                            <input type="time" id="time1_${index}" value="${daySchedule.time1 || ''}" />
                            <input type="time" id="time2_${index}" value="${daySchedule.time2 || ''}" />
                            <label class="toggle-switch">
                                <input type="checkbox" id="enabled_${index}" ${daySchedule.enabled ? 'checked' : ''} />
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    `;
                });
            })
            .catch(err => console.error('Error loading schedule:', err));
        }

        function saveSchedule() {
            const schedule = [];
            for (let i = 0; i < 7; i++) {
                schedule.push({
                    enabled: document.getElementById(`enabled_${i}`).checked,
                    time1: document.getElementById(`time1_${i}`).value,
                    time2: document.getElementById(`time2_${i}`).value
                });
            }

            fetch('/api/save_schedule', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({ schedule })
            })
            .then(res => res.json())
            .then(data => alert('✅ Schedule saved successfully!'))
            .catch(err => alert('❌ Error saving schedule: ' + err.message));
        }

        // Billing functions
        function loadBilling() {
            loadCredits();
            loadTransactions();
            loadAutoRecharge();
        }

        function loadCredits() {
            fetch('/api/profile', {
                credentials: 'include'
            })
            .then(res => res.json())
            .then(data => {
                const balance = (data.credit_balance || 0).toFixed(2);
                const estimated = Math.floor(data.credit_balance / 0.45);

                document.getElementById('creditBalance').textContent = balance;
                document.getElementById('currentBalance').textContent = balance;
                document.getElementById('estimatedArticles').textContent = estimated;
            })
            .catch(err => console.error('Error loading credits:', err));
        }

        function loadTransactions() {
            fetch('/api/profile', {
                credentials: 'include'
            })
            .then(res => res.json())
            .then(data => {
                const userId = data.id;
                return fetch(`/api/users/${userId}/transactions`, {
                    credentials: 'include'
                });
            })
            .then(res => res.json())
            .then(data => {
                const history = document.getElementById('transactionHistory');
                if (!data.transactions || data.transactions.length === 0) {
                    history.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">No transactions yet</p>';
                    return;
                }

                let html = '<table style="width: 100%; border-collapse: collapse;">';
                html += '<tr style="background: #f8f9ff; font-weight: 600;"><th style="padding: 12px; text-align: left;">Date</th><th style="padding: 12px; text-align: left;">Type</th><th style="padding: 12px; text-align: right;">Amount</th></tr>';

                data.transactions.forEach(t => {
                    const date = new Date(t.created_at).toLocaleDateString();
                    const type = t.transaction_type === 'purchase' ? '💳 Purchase' : '📝 Article';
                    const amountClass = t.transaction_type === 'purchase' ? 'color: #28a745' : 'color: #dc3545';
                    const amount = t.transaction_type === 'purchase' ? `+$${t.amount.toFixed(2)}` : `-$${Math.abs(t.amount).toFixed(2)}`;

                    html += `<tr style="border-bottom: 1px solid #eee;"><td style="padding: 12px;">${date}</td><td style="padding: 12px;">${type}</td><td style="padding: 12px; text-align: right; ${amountClass}; font-weight: 600;">${amount}</td></tr>`;
                });

                html += '</table>';
                history.innerHTML = html;
            })
            .catch(err => {
                document.getElementById('transactionHistory').innerHTML = '<p style="color: #dc3545; text-align: center; padding: 40px;">Error loading transactions</p>';
            });
        }

        function loadAutoRecharge() {
            fetch('/api/profile', {
                credentials: 'include'
            })
            .then(res => res.json())
            .then(data => {
                const enabled = data.auto_recharge_enabled || false;
                document.getElementById('autoRechargeEnabled').checked = enabled;
                document.getElementById('autoRechargeSettings').style.display = enabled ? 'block' : 'none';

                if (data.auto_recharge_threshold) {
                    document.getElementById('autoRechargeThreshold').value = data.auto_recharge_threshold;
                }
                if (data.auto_recharge_amount) {
                    document.getElementById('autoRechargeAmount').value = data.auto_recharge_amount;
                }
            })
            .catch(err => console.error('Error loading auto-recharge:', err));

            // Add event listener for checkbox
            document.getElementById('autoRechargeEnabled').addEventListener('change', function() {
                document.getElementById('autoRechargeSettings').style.display = this.checked ? 'block' : 'none';
            });
        }

        async function purchaseCredits() {
            const amount = parseFloat(document.getElementById('creditPackage').value);

            try {
                const res = await fetch('/api/credits/purchase', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ amount })
                });

                const data = await res.json();

                if (data.checkout_url) {
                    // Redirect to Stripe checkout
                    window.location.href = data.checkout_url;
                } else {
                    alert('❌ Error creating checkout session');
                }
            } catch (err) {
                alert('❌ Error: ' + err.message);
            }
        }

        async function saveAutoRecharge() {
            const enabled = document.getElementById('autoRechargeEnabled').checked;
            const threshold = enabled ? parseFloat(document.getElementById('autoRechargeThreshold').value) : null;
            const amount = enabled ? parseFloat(document.getElementById('autoRechargeAmount').value) : null;

            try {
                const profileRes = await fetch('/api/profile', { credentials: 'include' });
                const profileData = await profileRes.json();
                const userId = profileData.id;

                const res = await fetch(`/api/users/${userId}/auto-recharge`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({
                        enabled,
                        threshold,
                        amount
                    })
                });

                const data = await res.json();
                alert('✅ Auto-recharge settings saved!');
            } catch (err) {
                alert('❌ Error: ' + err.message);
            }
        }

        // Settings functions
        function loadSettings() {
            fetch('/api/profile', {
                credentials: 'include'
            })
            .then(res => res.json())
            .then(data => {
                if (data.wordpress_rest_api_url) document.getElementById('wpUrl').value = data.wordpress_rest_api_url;
                if (data.wordpress_username) document.getElementById('wpUsername').value = data.wordpress_username;
                if (data.wordpress_password) document.getElementById('wpPassword').value = data.wordpress_password;
                if (data.system_prompt) document.getElementById('systemPrompt').value = data.system_prompt;

                // Load brand colors
                const useDefault = data.use_default_branding !== false;
                document.getElementById('useDefaultBranding').checked = useDefault;

                const primaryColor = (data.brand_primary_color || '#08b2c6').toUpperCase();
                const accentColor = (data.brand_accent_color || '#ff6b11').toUpperCase();
                document.getElementById('brandPrimary').value = primaryColor;
                document.getElementById('brandPrimaryPicker').value = primaryColor;
                document.getElementById('brandAccent').value = accentColor;
                document.getElementById('brandAccentPicker').value = accentColor;

                // Setup color picker event listeners
                setupColorPickers();
            })
            .catch(err => console.error('Error loading settings:', err));
        }

        function saveWordPress() {
            fetch('/api/update_integrations', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({
                    wordpress_rest_api_url: document.getElementById('wpUrl').value,
                    wordpress_username: document.getElementById('wpUsername').value,
                    wordpress_password: document.getElementById('wpPassword').value
                })
            })
            .then(res => res.json())
            .then(data => alert('✅ WordPress settings saved!'))
            .catch(err => alert('❌ Error: ' + err.message));
        }

        // Brand customization functions
        function setupColorPickers() {
            const primaryPicker = document.getElementById('brandPrimaryPicker');
            const primaryText = document.getElementById('brandPrimary');
            const accentPicker = document.getElementById('brandAccentPicker');
            const accentText = document.getElementById('brandAccent');

            // Sync color picker -> text input
            primaryPicker.addEventListener('input', function() {
                primaryText.value = this.value.toUpperCase();
            });

            accentPicker.addEventListener('input', function() {
                accentText.value = this.value.toUpperCase();
            });

            // Sync text input -> color picker
            primaryText.addEventListener('input', function() {
                const hexPattern = /^#[0-9A-Fa-f]{6}$/;
                if (hexPattern.test(this.value)) {
                    primaryPicker.value = this.value;
                }
            });

            accentText.addEventListener('input', function() {
                const hexPattern = /^#[0-9A-Fa-f]{6}$/;
                if (hexPattern.test(this.value)) {
                    accentPicker.value = this.value;
                }
            });

            // Handle "Reset to Default" checkbox
            document.getElementById('useDefaultBranding').addEventListener('change', function() {
                if (this.checked) {
                    // Reset to defaults
                    primaryPicker.value = '#08b2c6';
                    primaryText.value = '#08b2c6';
                    accentPicker.value = '#ff6b11';
                    accentText.value = '#ff6b11';
                }
            });
        }

        function saveBrandColors() {
            const useDefault = document.getElementById('useDefaultBranding').checked;
            const primaryColor = document.getElementById('brandPrimary').value.toUpperCase();
            const accentColor = document.getElementById('brandAccent').value.toUpperCase();

            // Validate hex colors
            const hexPattern = /^#[0-9A-Fa-f]{6}$/;
            if (!hexPattern.test(primaryColor) || !hexPattern.test(accentColor)) {
                alert('❌ Please enter valid hex colors (e.g., #08B2C6)');
                return;
            }

            fetch('/api/update_brand_colors', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({
                    use_default_branding: useDefault,
                    brand_primary_color: primaryColor,
                    brand_accent_color: accentColor
                })
            })
            .then(res => res.json())
            .then(data => {
                alert('✅ Brand colors saved! Your custom colors will appear in new articles.');
                // Update the displayed values
                document.getElementById('brandPrimary').value = primaryColor;
                document.getElementById('brandPrimaryPicker').value = primaryColor;
                document.getElementById('brandAccent').value = accentColor;
                document.getElementById('brandAccentPicker').value = accentColor;
            })
            .catch(err => alert('❌ Error: ' + err.message));
        }

        // Update statistics
        function updateStats() {
            fetch('/api/get_specific_queries', {
                credentials: 'include'
            })
            .then(res => res.json())
            .then(data => {
                const count = Object.keys(data).filter(key => data[key]).length;
                document.getElementById('activeQueries').textContent = count;
            })
            .catch(err => console.error('Error updating stats:', err));
        }

        // Preview functions
        function showPreview(content) {
            document.getElementById('previewBody').innerHTML = content;
            document.getElementById('previewModal').classList.add('active');
        }

        function closePreview() {
            document.getElementById('previewModal').classList.remove('active');
        }

        // Initialize on load
        // Style Templates Data
        const styleTemplates = [
            {
                name: "Conversational/Personal",
                prompt: "Write this article in a warm, conversational tone as if you're chatting with a friend over coffee. Use first-person perspective ('I', 'my'), share relatable anecdotes or observations, and keep the language casual and approachable. Include rhetorical questions to engage the reader and don't be afraid to show personality or vulnerability."
            },
            {
                name: "Authoritative/Expert",
                prompt: "Write this article as an industry expert addressing professionals in the field. Use a confident, credible tone with precise terminology. Support claims with data, statistics, or research citations. Maintain a professional voice throughout, avoid casual language, and structure arguments logically. The goal is to establish authority and trustworthiness."
            },
            {
                name: "Narrative/Storytelling",
                prompt: "Write this article as a compelling story with a clear beginning, middle, and end. Include vivid descriptions, characters (real or representative), conflict or tension, and resolution. Use sensory details to immerse readers in the experience. Show rather than tell, and create an emotional journey that illustrates your main points through narrative."
            },
            {
                name: "Listicle/Scannable",
                prompt: "Write this article in a highly scannable format with numbered points or clear sections. Use descriptive subheadings, short paragraphs (2-3 sentences max), and bullet points where appropriate. Front-load key information in each section. Make it easy for readers to skim and extract value quickly. Include a brief intro and conclusion."
            },
            {
                name: "Investigative/Journalistic",
                prompt: "Write this article as objective journalism with thorough research and fact-checking. Present multiple perspectives, cite credible sources, and maintain neutrality. Use the inverted pyramid structure (most important information first). Include quotes from experts or stakeholders. Stick to verifiable facts and avoid opinion or speculation."
            },
            {
                name: "How-to/Instructional",
                prompt: "Write this article as a clear, actionable tutorial. Break down the process into numbered steps that are easy to follow. Use imperative verbs ('Click', 'Choose', 'Enter'). Include prerequisites, necessary materials, or tools upfront. Add tips, warnings, or troubleshooting advice where relevant. Focus on helping the reader successfully complete a specific task."
            },
            {
                name: "Opinion/Commentary",
                prompt: "Write this article as a persuasive opinion piece with a strong, clear point of view. State your thesis early and build a logical argument with supporting evidence. Use passionate but respectful language. Anticipate counterarguments and address them. Include examples that support your perspective. The goal is to convince readers or spark thoughtful debate."
            },
            {
                name: "Humorous/Satirical",
                prompt: "Write this article with wit and humor, using irony, exaggeration, or absurdist observations. Include clever wordplay, unexpected comparisons, or satirical takes on the subject. Keep the tone light and entertaining while still conveying your message. Use comedic timing with your sentence structure. Make readers laugh while making your point."
            }
        ];

        function showStyleTemplates() {
            const modal = document.getElementById('styleTemplateModal');
            modal.style.display = 'block';
        }

        function closeStyleTemplates() {
            const modal = document.getElementById('styleTemplateModal');
            modal.style.display = 'none';
        }

        function selectTemplate(index) {
            const template = styleTemplates[index];
            document.getElementById('systemPrompt').value = template.prompt;
            closeStyleTemplates();
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('styleTemplateModal');
            if (event.target == modal) {
                closeStyleTemplates();
            }
        }

        window.addEventListener('load', () => {
            loadSettings();
            updateStats();
            loadCredits(); // Load credit balance for display
        });
    </script>

    <!-- Style Template Modal -->
    <div id="styleTemplateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close-modal" onclick="closeStyleTemplates()">&times;</span>
                <h2>📋 Choose a Writing Style Template</h2>
            </div>
            <div class="modal-body">
                <div id="templateList">
                    <div class="template-item" onclick="selectTemplate(0)">
                        <div class="template-name">Conversational/Personal</div>
                        <div class="template-preview">Warm, friendly tone with first-person perspective and relatable anecdotes...</div>
                    </div>
                    <div class="template-item" onclick="selectTemplate(1)">
                        <div class="template-name">Authoritative/Expert</div>
                        <div class="template-preview">Professional, credible tone with data-driven insights and industry expertise...</div>
                    </div>
                    <div class="template-item" onclick="selectTemplate(2)">
                        <div class="template-name">Narrative/Storytelling</div>
                        <div class="template-preview">Compelling story structure with vivid descriptions and emotional journey...</div>
                    </div>
                    <div class="template-item" onclick="selectTemplate(3)">
                        <div class="template-name">Listicle/Scannable</div>
                        <div class="template-preview">Highly scannable format with numbered points and short paragraphs...</div>
                    </div>
                    <div class="template-item" onclick="selectTemplate(4)">
                        <div class="template-name">Investigative/Journalistic</div>
                        <div class="template-preview">Objective journalism with multiple perspectives and credible sources...</div>
                    </div>
                    <div class="template-item" onclick="selectTemplate(5)">
                        <div class="template-name">How-to/Instructional</div>
                        <div class="template-preview">Clear tutorial with step-by-step instructions and actionable guidance...</div>
                    </div>
                    <div class="template-item" onclick="selectTemplate(6)">
                        <div class="template-name">Opinion/Commentary</div>
                        <div class="template-preview">Persuasive opinion piece with strong arguments and supporting evidence...</div>
                    </div>
                    <div class="template-item" onclick="selectTemplate(7)">
                        <div class="template-name">Humorous/Satirical</div>
                        <div class="template-preview">Witty, entertaining style with wordplay and satirical observations...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
</html>